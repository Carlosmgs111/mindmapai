---
import type { Message } from "@/shared/stores/chat";
const { initialMessages = [], placeholder = "Escribe algo..." } = Astro.props;
---

<div
  class="flex flex-col border border-gray-700 rounded-lg bg-gray-900 overflow-hidden max-h-full"
>
  <!-- Messages Container -->
  <div
    id="chat-messages"
    class="flex-1 overflow-y-auto p-4 space-y-4 scroll-smooth"
  >
    {
      initialMessages.map((msg: Message) => (
        <div
          class={`flex ${msg.role === "user" ? "justify-end" : "justify-start"}`}
          data-message-id={msg.id}
        >
          <div
            class={`max-w-[80%] px-4 py-2 rounded-lg ${
              msg.role === "user"
                ? "bg-blue-600 text-white"
                : "bg-gray-800 text-gray-100 border border-gray-700"
            }`}
          >
            <p class="text-sm whitespace-pre-wrap break-words">{msg.content}</p>
            <span class="text-xs opacity-60 mt-1 block">
              {new Date(msg.timestamp).toLocaleTimeString("es-CO", {
                hour: "2-digit",
                minute: "2-digit",
              })}
            </span>
          </div>
        </div>
      ))
    }
  </div>

  <!-- Input Container -->
  <div class="border-t border-gray-700 p-4 bg-gray-800">
    <form id="chat-form" class="flex gap-2">
      <input
        type="text"
        id="chat-input"
        placeholder={placeholder}
        class="flex-1 px-4 py-2 bg-gray-900 border border-slate-700 rounded-lg text-slate-200 placeholder-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        autocomplete="off"
      />
      <button
        type="submit"
        class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
        id="chat-submit"
      >
        Enviar
      </button>
    </form>
  </div>
</div>

<script>
  import { ChatManager } from "./lib/ChatManager";
  document.addEventListener("astro:page-load", () => {
    const chatManager = new ChatManager();
  });
</script>
